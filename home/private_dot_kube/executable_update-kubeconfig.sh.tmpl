#!/usr/bin/env bash
# -*- coding: utf-8 -*-
mkdir -p ~/.kube/backup
DATE=$(date -u +'%Y-%m-%dT%H:%M:%SZ')
echo $DATE
mv config backup/config-$DATE

{{- if .isWorkComputer }}

KUBELOGIN_CONFIGS="<kubeconfigs-here>"
REGULAR_CONFIGS="<kubeconfigs-here>"

for config in ${KUBELOGIN_CONFIGS//:/ }; do
    if [ -f "$config" ]; then
        echo "Converting $config with kubelogin..."
        KUBECONFIG=$config kubelogin convert-kubeconfig -l azurecli
    fi
done

ALL_CONFIGS="${KUBELOGIN_CONFIGS}:${REGULAR_CONFIGS}"

{{- else }}

ALL_CONFIGS="<kubeconfigs-here>"

{{- end }}

KUBECONFIG=$ALL_CONFIGS kubectl config view --merge --flatten >config